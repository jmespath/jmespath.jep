<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>0006-improved-identifiers - JMESPath Enhancement Proposals</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="overview.html">Overview</a></li><li class="chapter-item expanded affix "><a href="0001-nested-expressions.html">0001-nested-expressions</a></li><li class="chapter-item expanded affix "><a href="0003-functions.html">0003-functions</a></li><li class="chapter-item expanded affix "><a href="0004-pipes.html">0004-pipes</a></li><li class="chapter-item expanded affix "><a href="0005-array-slices.html">0005-array-slices</a></li><li class="chapter-item expanded affix "><a href="0006-improved-identifiers.html" class="active">0006-improved-identifiers</a></li><li class="chapter-item expanded affix "><a href="0007-filter-expressions.html">0007-filter-expressions</a></li><li class="chapter-item expanded affix "><a href="0008-exptype.html">0008-exptype</a></li><li class="chapter-item expanded affix "><a href="0009-improved.filters.html">0009-improved.filters</a></li><li class="chapter-item expanded affix "><a href="0010-slice-projects.html">0010-slice-projects</a></li><li class="chapter-item expanded affix "><a href="0011-let-function.html">0011-let-function</a></li><li class="chapter-item expanded affix "><a href="0012-raw-string-literals.html">0012-raw-string-literals</a></li><li class="chapter-item expanded affix "><a href="0018-lexical-scope.html">0018-lexical-scope</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">JMESPath Enhancement Proposals</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="improved-identifiers"><a class="header" href="#improved-identifiers">Improved Identifiers</a></h1>
<ul>
<li>JEP: 6</li>
<li>Author: James Saryerwinnie</li>
<li>Created: 2013-12-14</li>
</ul>
<h2 id="abstract"><a class="header" href="#abstract">Abstract</a></h2>
<p>This JEP proposes grammar modifications to JMESPath in order to improve
identifiers used in JMESPath.  In doing so, several inconsistencies in the
identifier grammar rules will be fixed, along with an improved grammar for
specifying unicode identifiers in a way that is consistent with JSON
strings.</p>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>There are two ways to currently specify an identifier, the unquoted rule:</p>
<pre><code>identifier        = 1*char
</code></pre>
<p>and the quoted rule:</p>
<pre><code>identifier        =/ quote 1*(unescaped-char / escaped-quote) quote
</code></pre>
<p>The <code>char</code> rule contains a set of characters that do <strong>not</strong> have to be
quoted:</p>
<pre><code>char              = %x30-39 / ; 0-9
                    %x41-5A / ; A-Z
                    %x5F /    ; _
                    %x61-7A / ; a-z
                    %x7F-10FFFF
</code></pre>
<p>There is an ambiguity between the <code>%x30-39</code> rule and the <code>number</code> rule:</p>
<pre><code>number            = [&quot;-&quot;]1*digit
digit             = &quot;1&quot; / &quot;2&quot; / &quot;3&quot; / &quot;4&quot; / &quot;5&quot; / &quot;6&quot; / &quot;7&quot; / &quot;8&quot; / &quot;9&quot; / &quot;0&quot;
</code></pre>
<p>It’s ambiguous which rule to use.  Given a string “123”, it’s not clear whether
this should be parsed as an identifier or a number. Existing implementations
<strong>aren’t</strong> following this rule (because it’s ambiguous) so the grammar should
be updated to remove the ambiguity, specifically, an unquoted identifier can
only start with the characters <code>[a-zA-Z_]</code>.</p>
<h3 id="unicode"><a class="header" href="#unicode">Unicode</a></h3>
<p>JMESPath supports unicode through the <code>char</code>  and <code>unescaped-char</code> rule:</p>
<pre><code>unescaped-char    = %x30-10FFFF
char              = %x30-39 / ; 0-9
                    %x41-5A / ; A-Z
                    %x5F /    ; _
                    %x61-7A / ; a-z
                    %x7F-10FFFF
</code></pre>
<p>However, JSON supports a syntax for escaping unicode characters.  Any
character in the Basic Multilingual Plane (BMP) can be escaped with:</p>
<pre><code>char = escape (%x75 4HEXDIG )  ; \uXXXX
</code></pre>
<p>Similar to the way that XPath supports numeric character references used
in XML (<code>&amp;#nnnn</code>), JMESPath should support the same escape sequences
used in JSON.  JSON also supports a 12 character escape sequence for
characters outside of the BMP, by encoding the UTF-16 surrogate pair.
For example, the code point <code>U+1D11E</code> can be represented
as <code>&quot;\\uD834\\uDD1E&quot;</code>.</p>
<h3 id="escape-sequences"><a class="header" href="#escape-sequences">Escape Sequences</a></h3>
<p>Consider the following JSON object:</p>
<pre><code>{&quot;foo\nbar&quot;: &quot;baz&quot;}
</code></pre>
<p>A JMESPath expression should be able to retrieve the value of baz.  With
the current grammar, one must rely on the environment’s ability to input
control characters such as the newline (<code>%x0A</code>).  This can be problematic
in certain environments.  For example, in python, this is not a problem:</p>
<pre><code>&gt;&gt;&gt; jmespath_expression = &quot;foo\nbar&quot;
</code></pre>
<p>Python will interpret the sequence <code>&quot;\\n&quot;</code> (<code>%x5C %x6E</code>) as the newline
character <code>%x0A</code>.  However, consider Bash:</p>
<pre><code>$ foo --jmespath-expression &quot;foo\nbar&quot;
</code></pre>
<p>In this situation, bash will not interpret the <code>&quot;\\n&quot;</code> (<code>%x5C %x6E</code>)
sequence.</p>
<h2 id="specification"><a class="header" href="#specification">Specification</a></h2>
<p>The <code>char</code> rule contains a set of characters that do <strong>not</strong> have to be
quoted.  The new set of characters that do not have to quoted will be:</p>
<pre><code>unquoted-string   = (%x41-5A / %x61-7A / %x5F) *(%x30-39 / %x41-5A / %x5F / %x61-7A)
</code></pre>
<p>In order for an identifier to not be quoted, it must start with <code>[A-Za-z_]</code>,
then must be followed by zero or more <code>[0-9A-Za-z_]</code>.</p>
<p>The unquoted rule is updated to account for all JSON supported escape
sequences:</p>
<pre><code>quoted-string     =/ quote 1*(unescaped-char / escaped-char) quote
</code></pre>
<p>The full rule for an identifier is:</p>
<pre><code>identifier        = unquoted-string / quoted-string
unquoted-string   = (%x41-5A / %x61-7A / %x5F) *(  ; a-zA-Z_
                        %x30-39  /  ; 0-9
                        %x41-5A /  ; A-Z
                        %x5F    /  ; _
                        %x61-7A)   ; a-z
quoted-string     = quote 1*(unescaped-char / escaped-char) quote
unescaped-char    = %x20-21 / %x23-5B / %x5D-10FFFF
escape            = %x5C   ; Back slash: \
quote             = %x22   ; Double quote: '&quot;'
escaped-char      = escape (
                        %x22 /          ; &quot;    quotation mark  U+0022
                        %x5C /          ; \    reverse solidus U+005C
                        %x2F /          ; /    solidus         U+002F
                        %x62 /          ; b    backspace       U+0008
                        %x66 /          ; f    form feed       U+000C
                        %x6E /          ; n    line feed       U+000A
                        %x72 /          ; r    carriage return U+000D
                        %x74 /          ; t    tab             U+0009
                        %x75 4HEXDIG )  ; uXXXX                U+XXXX
</code></pre>
<h2 id="rationale"><a class="header" href="#rationale">Rationale</a></h2>
<p>Adopting the same string rules as JSON strings will allow users familiar with
JSON semantics to understand how JMESPath identifiers will work.</p>
<p>This change also provides a nice consistency for the literal syntax proposed
in JEP 3.  With this model, the supported literal strings can be the same
as quoted identifiers.</p>
<p>This also will allow the grammar to grow in a consistent way if JMESPath
adds support for filtering based on literal values.  For example (note that
this is just a suggested syntax, not a formal proposal), given the data:</p>
<pre><code>{&quot;foo&quot;: [{&quot;✓&quot;: &quot;✓&quot;}, {&quot;✓&quot;: &quot;✗&quot;}]}
</code></pre>
<p>You can now have the following JMESPath expressions:</p>
<pre><code>foo[?&quot;✓&quot; = `✓`]
foo[?&quot;\u2713&quot; = `\u2713`]
</code></pre>
<p>As a general property, any supported JSON string is now a supported quoted
identifier.</p>
<h2 id="impact"><a class="header" href="#impact">Impact</a></h2>
<p>For any implementation that was parsing digits as an identifier, identifiers
starting with digits will no longer be valid, e.g. <code>foo.0.1.2</code>.</p>
<p>There are several compliance tests that will have to be updated as a result
of this JEP.  They were arguably wrong to begin with.</p>
<h3 id="basicjson"><a class="header" href="#basicjson">basic.json</a></h3>
<p>The following needs to be changed because identifiers starting
with a number must now be quoted:</p>
<pre><code>-            &quot;expression&quot;: &quot;foo.1&quot;,
+            &quot;expression&quot;: &quot;foo.\&quot;1\&quot;&quot;,
             &quot;result&quot;: [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]
          },
          {
-            &quot;expression&quot;: &quot;foo.1[0]&quot;,
+            &quot;expression&quot;: &quot;foo.\&quot;1\&quot;[0]&quot;,
             &quot;result&quot;: &quot;one&quot;
          },
</code></pre>
<p>Similarly, the following needs to be changed because an unquoted
identifier cannot start with <code>-</code>:</p>
<pre><code>-            &quot;expression&quot;: &quot;foo.-1&quot;,
+            &quot;expression&quot;: &quot;foo.\&quot;-1\&quot;&quot;,
             &quot;result&quot;: &quot;bar&quot;
          }
</code></pre>
<h3 id="escapejson"><a class="header" href="#escapejson">escape.json</a></h3>
<p>The escape.json has several more interseting cases that need to be updated.
This has to do with the updated escaping rules.  Each one will be explained.</p>
<pre><code>-            &quot;expression&quot;: &quot;\&quot;foo\nbar\&quot;&quot;,
+            &quot;expression&quot;: &quot;\&quot;foo\\nbar\&quot;&quot;,
             &quot;result&quot;: &quot;newline&quot;
          },
</code></pre>
<p>This has to be updated because a JSON parser will interpret the <code>\\n</code> sequence
as the newline character.  The newline character is <strong>not</strong> allowed in a
JMESPath identifier (note that the newline character <code>%0A</code> is not in any
rule).  In order for a JSON parser to create a sequence of <code>%x5C %x6E</code>, the
JSON string must be <code>\\\\n</code> (<code>%x5C %x5C %x6E</code>).</p>
<pre><code>-            &quot;expression&quot;: &quot;\&quot;c:\\\\windows\\path\&quot;&quot;,
+            &quot;expression&quot;: &quot;\&quot;c:\\\\\\\\windows\\\\path\&quot;&quot;,
             &quot;result&quot;: &quot;windows&quot;
          },
</code></pre>
<p>The above example is a more pathological case of escaping.  In this example, we
have a string that represents a windows path “c:\windowpath”.  There are two
levels of escaping happening here, one at the JSON parser, and one at the
JMESPath parser.  The JSON parser will take the sequence
<code>&quot;\\&quot;c:\\\\\\\\\\\\\\\\windows\\\\\\\\path\\&quot;&quot;</code> and create the string
<code>&quot;\\&quot;c:\\\\\\\\windows\\\\path\\&quot;&quot;</code>.  The JMESPath parser will take the string
<code>&quot;\\&quot;c:\\\\\\\\windows\\\\path\\&quot;'</code> and, applying its own escaping rules, will
look for a key named <code>c:\\\\windows\\path</code>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="0005-array-slices.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="0007-filter-expressions.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="0005-array-slices.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="0007-filter-expressions.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
